<div class="dashboard-page">
  <header class="topbar">
    <div class="brand">
      <mat-icon>event_available</mat-icon>
      <span>AgendaFacil</span>
    </div>

    <nav class="top-nav" aria-label="Navegacao principal">
      <a class="nav-link active" routerLink="/dashboard">
        <mat-icon>dashboard</mat-icon>
        Dashboard
      </a>
      <a class="nav-link" routerLink="/services">
        <mat-icon>work_outline</mat-icon>
        Servicos
      </a>
      <a class="nav-link" routerLink="/schedule">
        <mat-icon>checklist</mat-icon>
        Agendamentos
      </a>
      <a class="nav-link" routerLink="/calendar">
        <mat-icon>calendar_today</mat-icon>
        Calendario
      </a>
    </nav>

    <div class="user-area">
      <div class="user-meta">
        <strong>{{ (user$ | async)?.name || 'Usuario' }}</strong>
        <span>{{ (user$ | async)?.email || 'usuario@exemplo.com' }}</span>
      </div>
      <button class="logout-button" mat-stroked-button (click)="logout()">
        <mat-icon>logout</mat-icon>
        Sair
      </button>
    </div>
  </header>

  @if (loading$ | async) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
  }

  <main class="main-content">
    <section class="hero">
      <h1>Ola, {{ (user$ | async)?.name || 'Usuario' }}!</h1>
      <p>Bem-vindo ao seu painel de controle</p>
    </section>

    <section class="summary-grid">
      @if (summary$ | async; as summary) {
        <mat-card class="summary-card green">
          <div class="summary-header">
            <span>Agendamentos Ativos</span>
            <mat-icon>assignment</mat-icon>
          </div>
          <strong>{{ summary.confirmedBookings }}</strong>
          <small>{{ upcomingCount$ | async }} proximos</small>
        </mat-card>

        <mat-card class="summary-card blue">
          <div class="summary-header">
            <span>Servicos Disponiveis</span>
            <mat-icon>work_outline</mat-icon>
          </div>
          <strong>{{ servicesCount$ | async }}</strong>
          <small>{{ summary.totalBookings }} total</small>
        </mat-card>

        <mat-card class="summary-card cyan">
          <div class="summary-header">
            <span>Total Gasto</span>
            <mat-icon>attach_money</mat-icon>
          </div>
          <strong>{{ summary.totalRevenue | currency: 'BRL' }}</strong>
          <small>{{ summary.totalBookings }} pagamentos</small>
        </mat-card>

        @if (pendingPayments$ | async; as pending) {
          <mat-card class="summary-card green">
            <div class="summary-header">
              <span>Pagamentos Pendentes</span>
              <mat-icon>schedule</mat-icon>
            </div>
            <strong>{{ pending.count }}</strong>
            <small>{{ pending.amount | currency: 'BRL' }}</small>
          </mat-card>
        }
      }
    </section>

    <section class="panels-grid">
      <mat-card class="panel-card">
        <div class="panel-header">
          <h2>Proximos Agendamentos</h2>
          <p>Seus agendamentos confirmados mais proximos</p>
        </div>

        @if (nextBooking$ | async; as booking) {
          <div class="next-booking">
            <div class="booking-top">
              <strong>{{ booking.serviceName }}</strong>
              <span>{{ booking.amount | currency: 'BRL' }}</span>
            </div>
            <span>{{ booking.startAt | date: "dd/MM/yyyy 'as' HH:mm" }}</span>
            <small>Confirmado â€¢ Pagamento pendente</small>
          </div>
        } @else {
          <p class="empty">Nenhum agendamento futuro.</p>
        }

        <button class="secondary-action" mat-button routerLink="/schedule">Ver Todos os Agendamentos</button>
      </mat-card>

      <mat-card class="panel-card">
        <div class="panel-header">
          <h2>Acoes Rapidas</h2>
          <p>Acesse as principais funcionalidades</p>
        </div>

        <div class="actions-list">
          <button mat-stroked-button routerLink="/services">
            <mat-icon>work_outline</mat-icon>
            Navegar Servicos Disponiveis
          </button>
          <button mat-stroked-button routerLink="/calendar">
            <mat-icon>calendar_today</mat-icon>
            Ver Calendario Completo
          </button>
          <button mat-stroked-button routerLink="/schedule">
            <mat-icon>event_note</mat-icon>
            Gerenciar Meus Agendamentos
          </button>
        </div>

        @if (summary$ | async; as summary) {
          <div class="status-grid">
            <p><span>Confirmados</span> <strong>{{ summary.confirmedBookings }}</strong></p>
            <p><span>Cancelados</span> <strong>{{ summary.cancelledBookings }}</strong></p>
            <p><span>Pagamentos Pendentes</span> <strong>{{ pendingCount$ | async }}</strong></p>
          </div>
        }
      </mat-card>
    </section>
  </main>
</div>
